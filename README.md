# Project Overview
This project is a RESTful API implemented in Go, designed to support user management, feed creation, and feed-follow functionality using PostgreSQL as the database. The project is structured into multiple phases to implement core features incrementally.

---

## Phase 1: HTTP Server Initialization

- **Initialized HTTP Server** using the `chi` package for routing.
- **Health Check Endpoint**: A simple health check API to verify that the server is running.

---

## Phase 2: Database Configuration

- **Configured PostgreSQL**:
  - Created a local PostgreSQL database.
  - Setup database connection URL: 
    ```
    postgres://<your_username>:<your_password>@localhost:5432/<your_db_name>?sslmode=disable
    ```
- **Configured `sqlc.yaml`**:
  - Set up the `queries` and `schema` directories within the `sql` folder.
- **Database Connection**:
  - Established connection with PostgreSQL.
  - Configured `connectionMaxIdleTime`.
  - Passed the connection pointer to `handlers/handleDBconn.go`.

---

## Phase 3: User APIs

### Database Setup
- **Schema Migration**:
  - Created `001_user.sql` in `sql/schema` for creating and dropping the `user` table.
  - Ran migrations using Goose:
    ```
    cd sql/schema
    goose postgres CONN up
    ```
    *`CONN` is the database connection URL excluding the `sslmode` flag.*

- **Query Generation**:
  - Created `user.sql` in `sql/queries`.
  - Generated Go code using:
    ```
    sqlc generate
    ```
    This generated `users.sql.go` in `internal/database`.

### Handlers
- **Create User API (`POST`)**:
  - Implemented in `handlers/handleUser.go`.
  - Utilizes the `createUser` function generated by `sqlc` to insert a user into the database.

- **Get User by API Key API (`GET`)**:
  - Implemented in `handlers/handleUser.go`.
  - Uses `GetApiKey` (from `internal/auth`) to validate the API key format and retrieve it from the client request.
  - Fetches the user using the `GetUserByApiKey` function generated by `sqlc`.

---

## Phase 4: Feed APIs

### Database Setup
- **Schema Migration**:
  - Created `002_feed.sql` in `sql/schema` for creating and dropping the `feeds` table.
  - Ran migrations using Goose:
    ```
    cd sql/schema
    goose postgres CONN up
    ```

- **Query Generation**:
  - Created `feeds.sql` in `sql/queries`.
  - Generated Go code using:
    ```
    sqlc generate
    ```
    This generated `feeds.sql.go` in `internal/database`.

### Handlers
- **Create Feed API (`POST`)**:
  - Implemented in `handlers/handleFeed.go`.
  - Utilizes the `createFeed` function generated by `sqlc` to create a feed for a specific user.
  - Fetches the user using the `GetAuthenticatedUserByApiKey` function in `handlers/handleUser.go` to associate the feed with the correct `user_id`.

---

## Phase 5: Feed-Follows APIs

### Database Setup
- **Schema Migration**:
  - Created `003_feed_follows.sql` in `sql/schema` for creating and dropping the `feed_follows` table.
  - Ran migrations using Goose:
    ```
    cd sql/schema
    goose postgres CONN up
    ```

- **Query Generation**:
  - Created `feed_follow.sql` in `sql/queries`.
  - Generated Go code using:
    ```
    sqlc generate
    ```
    This generated `feed_follow.sql.go` in `internal/database`.

### Handlers
- **Create Feed Follow API (`POST`)**:
  - Implemented in `handlers/handleFeedFollows.go`.
  - Creates a link between a user and a feed using the `createFeedFollow` function generated by `sqlc`.
  - Fetches the user using the `GetAuthenticatedUserByApiKey` function in `handlers/handleUser.go` to associate the `user_id` with the feed.

- **Get All Feed Follows API (`GET`)**:
  - Implemented in `handlers/handleFeedFollows.go`.
  - Retrieves all feeds followed by a specific user using the `getAllFeedFollow` function generated by `sqlc`.

- **Delete Feed Follow API (`DELETE`)**:
  - Implemented in `handlers/handleFeedFollows.go`.
  - Unfollows a feed by removing the link between the user and the feed.

---

## API Endpoints

### Endpoints List
- **Health Check**: `GET /healthcheck`
- **Create User**: `POST /createUser`
- **Get User by API Key**: `GET /getUserByApiKey`
- **Create Feed**: `POST /createFeed`
- **Create Feed Follow**: `POST /createFeedFollow`
- **Get All Feed Follows**: `GET /getAllFeedFollow`
- **Delete Feed Follow**: `DELETE /deleteFeedFollow/{feed_follow_id}`

---

## Getting Started

### Prerequisites
- Go 1.20+
- PostgreSQL 14+
- Goose CLI
- sqlc CLI

### Installation
1. Clone the repository:
    ```
    git clone <repository-url>
    cd <repository-folder>
    ```

2. Install dependencies:
    ```
    go mod tidy
    ```

3. Configure PostgreSQL and update the connection URL in the `.env` file.

4. Run migrations:
    ```
    cd sql/schema
    goose postgres CONN up
    ```

5. Generate query code:
    ```
    sqlc generate
    ```

### Running the Server
Start the HTTP server:
```bash
go run main.go
```

